```{r}
library(shiny)

# loading the data

icu_cohort <- readRDS(file = file.path("/Users/saanchishah/biostat-203b-2023-winter/hw3/mimiciv_shiny", 'icu_cohort.rds'))

head(icu_cohort, n = 5)

# modifying it so it makes sense for developing the app

icu_cohort_new <- icu_cohort %>% 
  mutate(thirty_day_mortality = if_else(duration < 30, 1, 0)) %>% 
  select(subject_id, stay_id, first_careunit, last_careunit, los, admission_type, 
         insurance, gender, ethnicity, Sodium, Chloride, WBC, Hematocrit, Glucose, 
         Bicarbonate, Creatinine, Potassium, age, thirty_day_mortality, Systolic_BP, 
         Diastolic_BP, Resp_rate, Heart_rate, Temperature)

head(icu_cohort_new, n = 5)
```



##Submitting this code

```{r}

# test out plots for some other variables
library(dplyr)


ui <- fluidPage(

  # App title ----
  titlePanel("Saanchi's icu cohort"),

  # Sidebar layout with input and output definitions ----
  sidebarLayout(

    # Sidebar panel for inputs ----
    sidebarPanel(

      # Input: Selector for variable to plot against mpg ----
      selectInput("variable", "Variable:",
                  choices = c("Hematocrit" ,
                              "Chloride" ,
                              "Sodium",
                              "Potassium",
                              "WBC",
                              "Glucose",
                              "Creatinine",
                              "Bicarbonate",
                              "gender",
                              "insurance",
                              "ethnicity",
                              "age",
                              "Systolic_BP",
                              "Diastolic_BP",
                              "Resp_rate",
                              "Heart_rate",
                              "Temperature",
                              "admission_type")),
 

      # Input: Checkbox for whether outliers should be included ----
      checkboxInput("outliers", "Show outliers", TRUE)

    ),

    # Main panel for displaying outputs ----
    mainPanel(

      # Output: Formatted text for caption ----
      h3(textOutput("caption")),

      # Output: Plot of the requested variable against mpg ----
      plotOutput("mortPlot")

    )
  )
)
server <- function(input, output) {

  # Compute the formula text ----
  # This is in a reactive expression since it is shared by the
  # output$caption and output$mpgPlot functions
  formulaText <- reactive({
    paste("Thirty day mortality ~", input$variable)
  })

  # Return the formula text for printing as a caption ----
  output$caption <- renderText({
    formulaText()
  })

  

  # Generate a plot of the requested variable against thirty_day_mortality ----
  # and only exclude outliers if requested
  output$mortPlot <- renderPlot({
  
#  output$mortPlot <- renderPlot({
  ggplot(data = icu_cohort_new) +
  geom_point(mapping = aes_string(x = "thirty_day_mortality", y = input$variable))
  })
}



shinyApp(ui, server)

```


